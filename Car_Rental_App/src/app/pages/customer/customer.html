<!-- Notification -->
<div *ngIf="notification() as notif"
  class="fade-in fixed top-24 right-8 z-50 max-w-sm rounded-lg border-l-4 p-4 shadow-xl" [ngClass]="{
        'border-green-500 bg-green-50': notif.type === 'success',
        'border-red-500 bg-red-50': notif.type === 'error'
      }" role="alert">
  <div class="flex items-center">
    <!-- Icon -->
    <svg *ngIf="notif.type === 'success'" class="h-6 w-6 flex-shrink-0 text-green-600"
      xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
    </svg>
    <svg *ngIf="notif.type === 'error'" class="h-6 w-6 flex-shrink-0 text-red-600" xmlns="http://www.w3.org/2000/svg"
      fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
    </svg>
    <!-- Message -->
    <div class="ml-3" [ngClass]="{
            'text-green-800': notif.type === 'success',
            'text-red-800': notif.type === 'error'
          }">
      <h3 class="font-bold">
        {{ notif.type === 'success' ? 'Success' : 'Error' }}
      </h3>
      <p class="text-sm">{{ notif.message }}</p>
    </div>
    <!-- Close Button -->
    <button (click)="notification.set(null)" class="ml-4 rounded-md p-1" [ngClass]="{
            'text-green-700 hover:bg-green-100': notif.type === 'success',
            'text-red-700 hover:bg-red-100': notif.type === 'error'
          }">
      <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
</div>

<!-- Main Content -->
<div class="rounded-2xl bg-white shadow-lg">
  <!-- Header -->
  <div class="flex flex-col items-start justify-between gap-4 border-b border-gray-200 p-6 sm:flex-row sm:items-center">
    <h2 class="text-lg font-semibold text-gray-900">
      <svg class="-mt-1 mr-2 inline h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
        <circle cx="9" cy="7" r="4" />
        <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
      </svg>
      Customer Management
    </h2>
    <div class="flex gap-3">
      <button (click)="loadCustomers()"
        class="flex items-center gap-2 rounded-md bg-white px-3.5 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 transition-colors hover:bg-gray-50"
        [disabled]="isLoading()">
        <svg class="h-4 w-4 text-gray-500" [class.animate-spin]="isLoading()" xmlns="http://www.w3.org/2000/svg"
          width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
          <path d="M21 3v5h-5" />
          <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
          <path d="M3 21v-5h5" />
        </svg>
        Refresh
      </button>
      <button (click)="openModal('new')"
        class="flex items-center gap-2 rounded-md bg-blue-600 px-3.5 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
        <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14" />
          <path d="M12 5v14" />
        </svg>
        Add Customer
      </button>
    </div>
  </div>

  <!-- Customer List -->
  <div class="relative overflow-x-auto">
    <!-- Loading Overlay -->
    <div *ngIf="isLoading()"
      class="absolute inset-0 z-10 flex items-center justify-center bg-white/70 backdrop-blur-sm">
      <svg class="h-8 w-8 animate-spin text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none"
        viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
        </path>
      </svg>
    </div>

    <!-- Table -->
    <table class="min-w-full divide-y divide-gray-200" [class.opacity-50]="isLoading()">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-600">
            Customer
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-600">
            Contact
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-600">
            City
          </th>
          <th scope="col"
            class="relative px-6 py-3 text-right text-xs font-semibold uppercase tracking-wider text-gray-600">
            Actions
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        <tr *ngIf="!isLoading() && customers().length === 0">
          <td colspan="4" class="px-6 py-12 text-center text-sm text-gray-500">
            No customers found.
          </td>
        </tr>
        <tr *ngFor="let customer of customers()" class="transition-colors hover:bg-gray-50">
          <td class="whitespace-nowrap px-6 py-4">
            <div class="text-sm font-medium text-gray-900">
              {{ customer.customerName }}
            </div>
            <div class="text-sm text-gray-500">
              ID: {{ customer.customerId }}
            </div>
          </td>
          <td class="whitespace-nowrap px-6 py-4">
            <div class="text-sm text-gray-900">{{ customer.mobileNo }}</div>
            <div class="text-sm text-gray-500">{{ customer.email }}</div>
          </td>
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-900">
            {{ customer.customerCity }}
          </td>
          <td class="whitespace-nowrap px-6 py-4 text-right text-sm font-medium">
            <button (click)="openModal('edit', customer)"
              class="mr-3 rounded-md p-1.5 text-blue-600 transition-colors hover:bg-blue-100 hover:text-blue-800"
              title="Edit">
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
                <path d="m15 5 4 4" />
              </svg>
            </button>
            <button (click)="openModal('delete', customer)"
              class="rounded-md p-1.5 text-red-600 transition-colors hover:bg-red-100 hover:text-red-800"
              title="Delete">
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18" />
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Add/Edit/Delete Modal -->
<div *ngIf="modal().mode !== 'closed'" class="fade-in fixed inset-0 z-50 flex items-center justify-center">
  <!-- Backdrop -->
  <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" (click)="closeModal()"></div>

  <!-- Modal Panel -->
  <div class="modal-scale-in relative z-10 w-full max-w-lg overflow-hidden rounded-2xl bg-white shadow-2xl">
    <form #customerForm="ngForm" (ngSubmit)="handleFormSubmit(customerForm)">
      <!-- Header -->
      <div class="flex items-start justify-between border-b p-6">
        <h3 class="text-lg font-semibold leading-6 text-gray-900">
          {{ modal().title }}
        </h3>
        <button type="button" (click)="closeModal()"
          class="-m-2 p-2 text-gray-400 transition-colors hover:text-gray-600">
          <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Content: Form -->
      <div *ngIf="modal().mode === 'new' || modal().mode === 'edit'">
        <div class="space-y-4 p-6">
          <div>
            <label for="customerName" class="block text-sm font-medium text-gray-700">Customer Name</label>
            <input type="text" id="customerName" [(ngModel)]="activeCustomer().customerName" name="customerName"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              required />
          </div>
          <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
            <div>
              <label for="mobileNo" class="block text-sm font-medium text-gray-700">Mobile Number</label>
              <input type="text" id="mobileNo" [(ngModel)]="activeCustomer().mobileNo" name="mobileNo"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                required />
            </div>
            <div>
              <label for="customerCity" class="block text-sm font-medium text-gray-700">City</label>
              <input type="text" id="customerCity" [(ngModel)]="activeCustomer().customerCity" name="customerCity"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                required />
            </div>
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
            <input type="email" id="email" [(ngModel)]="activeCustomer().email" name="email"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              email />
          </div>
        </div>
        <!-- Footer -->
        <div class="flex flex-row-reverse gap-3 bg-gray-50 px-6 py-4">
          <button type="submit"
            class="flex items-center justify-center rounded-md bg-blue-600 px-3.5 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600"
            [disabled]="isLoading() || customerForm.invalid">
            <svg *ngIf="isLoading()" class="-ml-1 mr-2 h-5 w-5 animate-spin" xmlns="http://www.w3.org/2000/svg"
              fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
              </path>
            </svg>
            {{ modal().mode === 'new' ? 'Create' : 'Save Changes' }}
          </button>
          <button type="button"
            class="rounded-md bg-white px-3.5 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 transition-colors hover:bg-gray-50"
            (click)="closeModal()">
            Cancel
          </button>
        </div>
      </div>

      <!-- Content: Delete Confirmation -->
      <div *ngIf="modal().mode === 'delete'">
        <div class="p-6">
          <div class="flex items-start gap-4">
            <div class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100">
              <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
              </svg>
            </div>
            <div class="min-w-0 flex-1">
              <p class="text-sm text-gray-600">{{ modal().message }}</p>
            </div>
          </div>
        </div>
        <!-- Footer -->
        <div class="flex flex-row-reverse gap-3 bg-gray-50 px-6 py-4">
          <button type="button"
            class="flex items-center justify-center rounded-md bg-red-600 px-3.5 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-red-700"
            (click)="handleDeleteConfirm()" [disabled]="isLoading()">
            <svg *ngIf="isLoading()" class="-ml-1 mr-2 h-5 w-5 animate-spin" xmlns="http://www.w3.org/2000/svg"
              fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
              </path>
            </svg>
            Delete
          </button>
          <button type="button"
            class="rounded-md bg-white px-3.5 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 transition-colors hover:bg-gray-50"
            (click)="closeModal()">
            Cancel
          </button>
        </div>
      </div>
    </form>
  </div>
</div>